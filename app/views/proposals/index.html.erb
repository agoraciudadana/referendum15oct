<div id="proposals_items">
  <ul>
  	<% @proposals.each_with_index do |proposal, index| %>
  	  <li id="proposal_<%= index + 1 %>">
  		  
  		  <div id="proposals_text">
  	      	<h2><%= index + 1 %> <%= proposal.name %></h2>
  	      	<div id="proposal_description">
  		  		<p><%= raw proposal.description %></p>
  		  	</div>
  		  </div>
  		  
  		  <div id="proposals_icon">
  		  	<%=image_tag("proposal_icon_1.png", :alt => "Icono de una un sobre entrando en una urna.")%>
  		  </div>
        
  		  <div id="proposals_buttons">
  		  	<ul>
  		    		<li><%= link_to "Sí", "#", :class => "vote", :name => "proposal_#{index + 1}", :value => "Sí" %></li>
  		    		<li><%= link_to "No", "#", :class => "vote", :name => "proposal_#{index + 1}", :value => "No" %></li>
  		    		<li><%= link_to "Abstención", "#", :class => "vote", :name => "proposal_#{index + 1}", :value => "Abstención" %></li>					
  		  	</ul>
  		  </div>

        <br/>
  	  </li>

  	<% end %>
  </ul>
</div>


<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {

    <% for i in (2..5) %>
      $("#proposal_<%= i %>").hide();
    <% end %>
    
    $("#confirmation").hide();
    
    <% for i in (1..5) %>
      $("#proposal_<%= i %> .vote").click(function () {
        $("#proposal_<%= i %>").fadeOut("slow", function() {
          $("#proposal_<%= i + 1%>").fadeIn("slow");
        });
      });
    <% end %>

    $("#proposal_5 .vote").click(function () {
      $("#proposal_5").fadeOut("slow", function() {
        $("#confirmation").fadeIn("slow");
      });
    });
  });
</script>

<script type="text/javascript" charset="utf-8">
  <% for i in (1..5) %>
    $("#proposal_<%= i %> .vote").click(function () {
      var proposal = $(this).attr("name");
      var choice = $(this).attr("value");
      $("#confirmation_" + proposal + " .choice").html(choice);
    });
  <% end %>
</script>


<script type="text/javascript" charset="utf-8">
  
  function sendVote()
  {

  var votos = [];
  
  for (var i = 1; i <= 5; i ++)
  {
    var propElem = document.getElementById("cp_prop_" + i);     
    var prop = propElem.innerHTML;    
    var votoElem = document.getElementById("cp_voto_" + i);    
    var valorVoto = votoElem.innerHTML;
    
    votos.push({vote:prop, propossal:valorVoto});
    
  }
  
  var sVotos = JSON.stringify(votos);
  
 // var hash = crypter.vote(sVotos); 
  
  document.write("<p>" + sVotos + "</p>");
  
  }
  
</script>


<div id="confirmation">
  
  <applet id="crypter" code="org.agora.VotingApplet.class" archive="/lib/agora-applet.jar, /lib/verificatum.jar, /lib/google-gson-stream-1.7.1.jar" width="0" height="0"></applet>
  
  
    <form>    
      <ul>
        <% @proposals.each_with_index do |proposal, index| %>
          <li id="confirmation_proposal_<%= index + 1 %>">

            <h2><span class="number"><%= index + 1 %></span>

            <span id="cp_prop_<%= index + 1 %>" class="title"><%= proposal.name %></span></h2>
          
            <span id="cp_voto_<%= index + 1 %>" class="choice"></span>

 			<span class="change"><%= link_to "<< cambiar", "" %></span>
  
           </li>
        <% end %>
      </ul>

     <div id="send_button"><%= link_to "Envía tu voto", retrieve_dni_path %></div>
    
      <A HREF="javascript:sendVote()"> VOTA (INVOCA VotingApplet) </A>
      
      <pre id='params'>
      </pre>
      
    </form>
  </applet>
</div>